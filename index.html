<!DOCTYPE html>
<html>
<head>
    <title>Connection Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>body{background:#111;color:#fff;font-family:sans-serif;padding:20px;}</style>
</head>
<body>
    <h2>Supabase Diagnostic</h2>
    <div id="status">Connecting...</div>
    <div id="log" style="font-family:monospace; margin-top:20px; color:#aaa;"></div>

    <script>
        // 1. YOUR CREDENTIALS
        const SB_URL = "https://qkxbwxhvlcztjtnonjm.supabase.co"; 
        const SB_KEY = "sb_publishable_XHjxXNo2v7Ahwv1ddJ35Ug_tqDRRQeE"; // Note: This key looks odd in your screenshot, usually they start with 'eyJ...'

        // Function to log messages to screen
        function log(msg) { 
            document.getElementById('log').innerHTML += "<div>" + msg + "</div>"; 
            console.log(msg);
        }

        async function testConnection() {
            try {
                // Step A: Initialize
                log("1. Initializing Client...");
                const supabase = window.supabase.createClient(SB_URL, SB_KEY);
                
                // Step B: Try to Read
                log("2. Attempting to READ from 'leaderboard'...");
                const { data, error } = await supabase.from('leaderboard').select('*').limit(1);

                if (error) {
                    throw error;
                }
                
                log("<b style='color:#0f0'>SUCCESS: Read connection working!</b>");
                log("Data found: " + JSON.stringify(data));

                // Step C: Try to Write (Test Row)
                log("3. Attempting to WRITE a test row...");
                const { error: writeErr } = await supabase.from('leaderboard').upsert({
                    user_id: "test_user_999",
                    username: "ConnectionBot",
                    balance: 100
                });

                if (writeErr) throw writeErr;
                
                document.getElementById('status').innerText = "✅ SYSTEM OPERATIONAL";
                document.getElementById('status').style.color = "#0f0";
                log("<b style='color:#0f0'>SUCCESS: Write connection working!</b>");

            } catch (err) {
                document.getElementById('status').innerText = "❌ CONNECTION FAILED";
                document.getElementById('status').style.color = "#f00";
                log("<b style='color:red'>ERROR: " + err.message + "</b>");
                log("Hint: Check your Table Name, Column Names, or RLS Policies.");
            }
        }

        testConnection();
    </script>
</body>
</html>
