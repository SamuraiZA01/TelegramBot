<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Empire Pro: Vegas</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #0b0e14; --card: #1c212b; --primary: #3b82f6; --accent: #fbbf24; --success: #10b981; --prestige: #a855f7; --danger: #ef4444; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; height: 100vh; }
        .header { padding: 15px 20px; background: #1e293b; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; }
        .stat-val { font-size: 24px; font-weight: 800; color: var(--accent); }
        .prestige-badge { background: var(--prestige); font-size: 10px; padding: 2px 8px; border-radius: 10px; font-weight: bold; }

        /* Game Screen */
        .click-area { height: 45vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #main-target { width: 180px; height: 180px; border-radius: 50%; background: radial-gradient(circle, #3b82f6, #1e3a8a); display: flex; align-items: center; justify-content: center; box-shadow: 0 0 40px rgba(59, 130, 246, 0.4); cursor: pointer; transition: transform 0.05s; }
        #main-target:active { transform: scale(0.9); }
        #main-target img { width: 100px; height: 100px; object-fit: contain; }

        /* Tabs */
        .tab-bar { display: flex; background: #2d3748; margin: 10px 20px; border-radius: 12px; overflow: hidden; }
        .tab { flex: 1; padding: 10px; border: none; background: none; color: #94a3b8; font-weight: bold; cursor: pointer; }
        .tab.active { background: var(--primary); color: white; }

        /* Market Sheet */
        .market-sheet { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); border-radius: 25px 25px 0 0; height: 65vh; transform: translateY(85%); transition: transform 0.3s ease; z-index: 100; box-shadow: 0 -10px 30px rgba(0,0,0,0.5); }
        .market-sheet.open { transform: translateY(0); }
        .handle { height: 35px; width: 100%; display: flex; justify-content: center; align-items: center; }
        .bar { width: 40px; height: 4px; background: #475569; border-radius: 2px; }
        .content { padding: 0 20px 20px; overflow-y: auto; height: calc(100% - 40px); }

        .item { background: #2d3748; padding: 12px; border-radius: 15px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #3e4b5e; }
        .buy-btn { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 10px; font-weight: bold; }
        .gamble-btn { background: var(--danger); width: 100%; padding: 15px; border-radius: 15px; border: none; color: white; font-weight: bold; margin-top: 10px; }
        .pop { position: absolute; color: var(--accent); font-weight: bold; animation: popUp 0.6s forwards; pointer-events: none; }
        @keyframes popUp { to { transform: translateY(-80px); opacity: 0; } }
    </style>
</head>
<body>

    <div class="header">
        <div><div style="font-size: 10px; color: #94a3b8;">BALANCE</div><div class="stat-val">$<span id="bal">0</span></div></div>
        <div style="text-align: right;"><div id="mult" class="prestige-badge">x1 Multiplier</div><div style="color: #10b981; font-weight: bold;">+$<span id="psv">0</span>/s</div></div>
    </div>

    <div class="click-area">
        <div id="main-target" onclick="doClick(event)"><img id="target-img" src="https://img.icons8.com/fluency/240/rocket.png"></div>
        <div style="margin-top:20px; width:80%;">
            <div id="nrg-t" style="font-size:12px; margin-bottom:5px;">Energy: 1000/1000</div>
            <div style="background:#334155; height:6px; border-radius:3px; overflow:hidden;"><div id="nrg-f" style="background:var(--success); width:100%; height:100%;"></div></div>
        </div>
    </div>

    <div class="tab-bar">
        <button class="tab active" onclick="setTab('market')">Upgrades</button>
        <button class="tab" onclick="setTab('skins')">Skins</button>
        <button class="tab" onclick="setTab('gamble')">Gamble</button>
    </div>

    <div class="market-sheet" id="sheet">
        <div class="handle" onclick="document.getElementById('sheet').classList.toggle('open')"><div class="bar"></div></div>
        <div class="content" id="main-content"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        let currentTab = 'market';
        let game = JSON.parse(localStorage.getItem('pixel_v3')) || {
            bal: 0, psv: 0, nrg: 1000, mult: 1, skin: 'https://img.icons8.com/fluency/240/rocket.png',
            up: { intern: 0, office: 0, manager: 0 }
        };

        const config = {
            market: { intern: { n: "Intern", b: 50, i: 1 }, office: { n: "Office", b: 500, i: 10 }, manager: { n: "Manager", b: 2500, i: 60 } },
            skins: { supercar: { n: "Supercar", c: 5000, img: "https://img.icons8.com/fluency/240/sport-car.png" }, coin: { n: "Gold Coin", c: 25000, img: "https://img.icons8.com/fluency/240/gold-bars.png" } }
        };

        function setTab(t) {
            currentTab = t;
            document.querySelectorAll('.tab').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase().includes(t)));
            render();
        }

        function render() {
            document.getElementById('bal').innerText = Math.floor(game.bal).toLocaleString();
            document.getElementById('psv').innerText = (game.psv * game.mult).toLocaleString();
            document.getElementById('mult').innerText = `x${game.mult} Multiplier`;
            document.getElementById('target-img').src = game.skin;
            const container = document.getElementById('main-content');
            container.innerHTML = `<h2>${currentTab.toUpperCase()}</h2>`;

            if(currentTab === 'market') {
                Object.keys(config.market).forEach(k => {
                    let item = config.market[k]; let cost = Math.floor(item.b * Math.pow(1.3, game.up[k]));
                    container.innerHTML += `<div class="item"><div><b>${item.n}</b> (Lv ${game.up[k]})</div><button class="buy-btn" onclick="buy('${k}',${cost})">$${cost}</button></div>`;
                });
            } else if(currentTab === 'skins') {
                Object.keys(config.skins).forEach(k => {
                    let s = config.skins[k];
                    container.innerHTML += `<div class="item"><div><b>${s.n}</b></div><button class="buy-btn" onclick="buySkin('${s.img}',${s.c})">$${s.c}</button></div>`;
                });
            } else {
                container.innerHTML += `<p>Double your balance or lose it all! (50/50 Chance)</p><button class="gamble-btn" onclick="gamble()">BET 50% OF BALANCE</button>`;
            }
            localStorage.setItem('pixel_v3', JSON.stringify(game));
        }

        function doClick(e) {
            if(game.nrg >= 1) { game.bal += (1 * game.mult); game.nrg--; showPop(e, (1 * game.mult)); tg.HapticFeedback.impactOccurred('light'); render(); }
        }

        function buy(k, cost) { if(game.bal >= cost) { game.bal -= cost; game.up[k]++; game.psv += config.market[k].i; tg.HapticFeedback.notificationOccurred('success'); render(); } }
        function buySkin(img, cost) { if(game.bal >= cost) { game.bal -= cost; game.skin = img; render(); } }
        function gamble() {
            let bet = game.bal * 0.5;
            if(Math.random() > 0.5) { game.bal += bet; alert("WINNER! +$" + Math.floor(bet)); }
            else { game.bal -= bet; alert("BUSTED! -$" + Math.floor(bet)); }
            render();
        }

        function showPop(e, g) {
            const p = document.createElement('div'); p.className='pop'; p.innerText=`+$${g}`; p.style.left=e.pageX+'px'; p.style.top=e.pageY+'px';
            document.body.appendChild(p); setTimeout(()=>p.remove(),600);
        }

        setInterval(() => { game.bal += (game.psv * game.mult / 10); if(game.nrg < 1000) game.nrg += 0.5; render(); }, 100);
        render();
    </script>
</body>
</html>
