<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Pixel Empire</title>

<!-- Telegram SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Telegram Analytics SDK -->
<script
  async
  src="https://tganalytics.xyz/index.js"
  onload="initAnalytics()"
  type="text/javascript"
></script>

<script>
function initAnalytics() {
  if (!window.telegramAnalytics || !window.Telegram?.WebApp) return;

  window.telegramAnalytics.init({
    token: 'eyJhcHBfbmFtZSI6InBpeGVsZW1waXJlIiwiYXBwX3VybCI6Imh0dHBzOi8vdC5tZS9TcXVhZFR1Z0JvdCIsImFwcF9kb21haW4iOiJodHRwczovL3RlbGVncmFtLWJvdC1jaGkta2hha2kudmVyY2VsLmFwcC8ifQ==!Yy3Hlgd483Q10U3xZGcC+UWARwJ4LDxtwZ+rUYYo5kI=',
    appName: 'pixelempire'
  });
}
</script>

<style>
:root { --bg:#0b0e14;--card:#1c212b;--primary:#3b82f6;--accent:#fbbf24;--success:#10b981;--purple:#a855f7 }
body { background:var(--bg);color:#fff;font-family:Segoe UI,sans-serif;margin:0;overflow:hidden;height:100vh;user-select:none }
.header{padding:15px 20px;background:#1e293b;display:flex;justify-content:space-between;border-bottom:1px solid #334155}
.stat-val{font-size:24px;font-weight:800;color:var(--accent)}
.click-area{height:38vh;display:flex;flex-direction:column;align-items:center;justify-content:center}
#main-target{width:160px;height:160px;border-radius:50%;background:radial-gradient(circle,#3b82f6,#1e3a8a);display:flex;align-items:center;justify-content:center;cursor:pointer}
#main-target img{width:90px;height:90px}
.tab-bar{display:flex;background:#2d3748;margin:5px 15px;border-radius:12px;padding:5px;gap:5px}
.tab{flex:1;padding:12px 0;border:none;background:none;color:#94a3b8;font-weight:bold;font-size:10px}
.tab.active{background:var(--primary);color:white}
.market-sheet{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-radius:30px 30px 0 0;height:85vh;transform:translateY(75%);transition:.3s}
.content{padding:20px;overflow-y:auto}
.item{background:#2d3748;padding:12px;border-radius:16px;margin-bottom:10px;display:flex;justify-content:space-between}
.buy-btn{border:none;padding:10px 15px;border-radius:10px;font-weight:bold;color:white}
.btn-available{background:var(--primary)}
.btn-locked{background:#475569;opacity:.5}
.btn-claim{background:var(--success)}
.pop{position:absolute;color:var(--accent);font-weight:bold;animation:pop .6s forwards}
@keyframes pop{to{transform:translateY(-100px);opacity:0}}
</style>
</head>

<body>

<div class="header">
  <div><div style="font-size:10px">BAL</div><div class="stat-val">$<span id="bal">0</span></div></div>
  <div><div style="font-size:10px">PASSIVE</div><div>+$<span id="psv">0</span>/s</div></div>
</div>

<div class="click-area">
  <div id="main-target" onmousedown="doClick(event)" ontouchstart="doClick(event)">
    <img id="target-img" src="https://img.icons8.com/fluency/240/rocket.png">
  </div>
</div>

<div class="tab-bar">
  <button class="tab active" onclick="setTab('market')">Upgrades</button>
  <button class="tab" onclick="setTab('skins')">Skins</button>
  <button class="tab" onclick="setTab('gamble')">Gamble</button>
</div>

<div class="market-sheet">
  <div class="content" id="main-content"></div>
</div>

<script>
const tg = Telegram.WebApp; tg.expand();

let game = JSON.parse(localStorage.getItem('pixel_empire')) || {
  bal:10000,psv:0,clickPower:1,skin:'https://img.icons8.com/fluency/240/rocket.png'
};

const upgrades = {
  click:{n:'Click Power',cost:100,val:1},
  intern:{n:'Intern',cost:200,val:2}
};

function doClick(e){
  game.bal += game.clickPower;
  showPop(e);

  window.telegramAnalytics?.track('click',{
    power:game.clickPower,
    balance:Math.floor(game.bal)
  });

  render();
}

function buyUpgrade(k){
  let u=upgrades[k];
  if(game.bal<u.cost)return;
  game.bal-=u.cost;
  game.psv+=u.val;

  window.telegramAnalytics?.track('upgrade_buy',{
    upgrade:k,
    cost:u.cost,
    balance:Math.floor(game.bal)
  });

  render();
}

function gamble(){
  let bet=game.bal*0.5;
  let win=Math.random()>0.5;
  game.bal+=win?bet:-bet;

  window.telegramAnalytics?.track('gamble',{
    bet:Math.floor(bet),
    win:win,
    balance:Math.floor(game.bal)
  });

  render();
}

function setTab(t){
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');

  let c=document.getElementById('main-content');
  c.innerHTML='';

  if(t==='market'){
    Object.keys(upgrades).forEach(k=>{
      c.innerHTML+=`<div class="item"><b>${upgrades[k].n}</b><button class="buy-btn btn-available" onclick="buyUpgrade('${k}')">$${upgrades[k].cost}</button></div>`;
    });
  }
  if(t==='skins'){
    c.innerHTML+=`<div class="item"><b>Rocket</b><button class="buy-btn btn-available" onclick="game.skin='https://img.icons8.com/fluency/240/rocket.png';render()">EQUIP</button></div>`;
  }
  if(t==='gamble'){
    c.innerHTML+=`<button class="buy-btn btn-available" style="width:100%" onclick="gamble()">BET 50%</button>`;
  }
}

function showPop(e){
  let p=document.createElement('div');
  p.className='pop';
  p.innerText=`+$${game.clickPower}`;
  p.style.left=(e?.pageX||150)+'px';
  p.style.top=(e?.pageY||300)+'px';
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),600);
}

function render(){
  document.getElementById('bal').innerText=Math.floor(game.bal);
  document.getElementById('psv').innerText=game.psv;
  document.getElementById('target-img').src=game.skin;
  localStorage.setItem('pixel_empire',JSON.stringify(game));
}

setInterval(()=>{game.bal+=game.psv/10;render()},100);
render();
</script>

</body>
</html>
